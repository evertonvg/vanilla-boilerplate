---
import { getCollection } from 'astro:content'

import Image from '@/components/ui/Image/Image.astro'
import Container from '@/components/layout/Container/Container.astro'
import Heading from '@/components/ui/Heading/Heading.astro'
import Text from '@/components/ui/Text/Text.astro'
import Button from '@/components/ui/Button/Button.astro'

import styles from './HeroCarousel.module.scss'

const heroes = (await getCollection('hero'))
  .sort((a, b) => (a.data.order ?? 0) - (b.data.order ?? 0))

const hasMultiple = heroes.length > 1

const { heightMobile = 100, heightTablet = 60, heightDesktop = 85 } = Astro.props;
---

{heroes.length > 0 && (
  <section class={styles.heroCarousel} x-data="heroCarousel" x-init="init()">
    <div
      class={`swiper hero-swiper ${styles.heroSwiper} ${
        !hasMultiple ? styles.heroSwiperSingle : ''
      }`}
    >
      <div class="swiper-wrapper">

        {heroes.map((hero, index) => (
          <div class="swiper-slide">
            <section
              class={`${styles.hero} ${styles[`heroAlign${hero.data.align.charAt(0).toUpperCase() + hero.data.align.slice(1)}`]}`}
              style={`
                --carousel-height-mobile: ${heightMobile}vh;
                --carousel-height-tablet: ${heightTablet}vh;
                --carousel-height-desktop: ${heightDesktop}vh;
              `}
            >
              <div class={styles.heroMedia}>
                <Image
                  alt={hero.data.image.alt}
                  fallbackSrc={hero.data.image.fallbackSrc}
                  sources={hero.data.image.sources}
                  loading={index === 0 ? 'eager' : 'lazy'}
                  decoding="async"
                  class={styles.heroImage}
                />
              </div>

              <Container size="lg">
                <div class={styles.heroContent}>
                  {hero.data.title && (
                    <Heading level="h1">
                      {hero.data.title}
                    </Heading>
                  )}

                  {hero.data.description && (
                    <Text size="lg" class={styles.heroDescription}>
                      {hero.data.description}
                    </Text>
                  )}

                  {hero.data.buttons && (
                    <div class={styles.heroActions}>
                      {hero.data.buttons.map((btn) => (
                        <Button
                          href={btn.href}
                          variant="primary"
                        >
                          {btn.label}
                        </Button>
                      ))}
                    </div>
                  )}
                </div>
              </Container>
            </section>
          </div>
        ))}

      </div>

      {/* Arrows */}
      {hasMultiple && (
        <>
          <button
            class={`${styles.customPrev} custom-prev`}
            aria-label="Anterior"
          >
            <span
              class="iconify"
              data-icon="mdi:chevron-left"
              style="font-size: 32px;"
            ></span>
          </button>

          <button
            class={`${styles.customNext} custom-next`}
            aria-label="PrÃ³ximo"
          >
            <span
              class="iconify"
              data-icon="mdi:chevron-right"
              style="font-size: 32px;"
            ></span>
          </button>
        </>
      )}

      {/* Dots */}
      {hasMultiple && (
        <div class="swiper-pagination"></div>
      )}
    </div>
  </section>
)}
