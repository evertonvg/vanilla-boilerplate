---
import Button from '@/components/ui/Button/Button.astro'
import UiImage from '@/components/ui/Image/Image.astro'
import Container from '../Container/Container.astro'
import { getCollection } from 'astro:content'
import styles from './Header.module.scss'

export interface Props {
  sticky?: 'static' | 'fixed' | 'smart'
}

const { sticky = 'static' } = Astro.props

const menuItems = (await getCollection('menu'))
  .map((item) => item.data)
  .sort((a, b) => a.order - b.order)

const desktopItems = menuItems.filter(
  (item) => item.showOnDesktop && !item.isCTA
)

const mobileItems = menuItems.filter(
  (item) => item.showOnMobile && !item.isCTA
)

const ctaItem = menuItems.find((item) => item.isCTA)
---

<header
  class={[
    styles.header,
    styles[`sticky-${sticky}`]
  ].join(' ')}
  x-data="header()"
  x-init="init()"
  @keydown.escape="close()"
>
  <Container size="xxl">
  <div class={`${styles.inner} container container--lg`}>
    
    <div class={styles.logo}>
      <a href="/" aria-label="PÃ¡gina inicial">
        <UiImage
          fallbackSrc="/logo.svg"
          alt="Nome da Empresa"
          width={120}
          height={40}
        />
      </a>
    </div>

    <nav class={styles.nav} aria-label="Menu principal">
      <ul class={styles.menu}>
        {desktopItems.map((item) => {
          const isAnchor = item.href?.startsWith('#')

          return (
            <li>
              <a
                href={item.href}
                class={styles.link}
                target={item.target}
                rel={item.rel}
                {...(isAnchor
                  ? { '@click.prevent': `scrollToAnchor('${item.href}')` }
                  : {})}
              >
                {item.label}
              </a>
            </li>
          )
        })}

        {ctaItem && (() => {
          const isAnchor = ctaItem.href?.startsWith('#')

          return (
            <li class={`${styles.cta} ${styles.ctaDesktop}`}>
              <Button
                variant="secondary"
                size="sm"
                href={ctaItem.href}
                target={ctaItem.target}
                {...(isAnchor
                  ? { '@click.prevent': `scrollToAnchor('${ctaItem.href}')` }
                  : {})}
              >
                {ctaItem.label}
              </Button>
            </li>
          )
        })()}
      </ul>
    </nav>

    <button
      class={styles.toggle}
      :class="{ 'is-active': open }"
      @click="toggle()"
      aria-label="Abrir menu"
      :aria-expanded="open.toString()"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
  </Container>

  <div class={styles.mobile} :class="{ 'is-open': open }">
    <nav aria-label="Menu mobile">
      <ul class={styles.mobileMenu}>
        {mobileItems.map((item) => {
          const isAnchor = item.href?.startsWith('#')

          return (
            <li>
              <a
                class={styles.mobileItem}
                href={item.href}
                target={item.target}
                rel={item.rel}
                {...(isAnchor
                  ? { '@click.prevent': `scrollToAnchor('${item.href}')` }
                  : { '@click': 'close()' })}
              >
                {item.label}
              </a>
            </li>
          )
        })}

        {ctaItem && (
          <li class={`${styles.cta} ${styles.ctaMobile}`}>
            <Button
              variant="primary"
              size="sm"
              href={ctaItem.href}
              target={ctaItem.target}
            >
              {ctaItem.label}
            </Button>
          </li>
        )}
      </ul>
    </nav>
  </div>
</header>
